<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập Thư viện</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* (Giữ nguyên CSS cũ, chỉ thêm CSS cho thông báo Flash) */
        :root { --primary-color: #4e54c8; --secondary-color: #8f94fb; --text-color: #333; --bg-color: #f0f2f5; --white: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 20px; }
        .container { position: relative; width: 100%; max-width: 850px; background: var(--white); border-radius: 20px; box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2); overflow: hidden; display: flex; flex-wrap: wrap; min-height: 550px; }
        
        /* Banner & Form CSS rút gọn cho đỡ dài (giống bài trước) */
        .banner-box { position: absolute; top: 0; left: 0; width: 50%; height: 100%; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: var(--white); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px; z-index: 10; transition: all 0.6s ease-in-out; }
        .banner-box h2 { font-size: 2.5rem; margin-bottom: 15px; }
        .btn-outline { background: transparent; border: 2px solid var(--white); color: var(--white); padding: 10px 30px; border-radius: 50px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-outline:hover { background: var(--white); color: var(--primary-color); }
        .form-box { position: absolute; top: 0; height: 100%; width: 50%; display: flex; justify-content: center; align-items: center; flex-direction: column; background: var(--white); transition: all 0.6s ease-in-out; padding: 40px; z-index: 5; }
        .form-box.sign-in { left: 0; }
        .form-box.sign-up { left: 0; opacity: 0; z-index: 1; }
        form { width: 100%; max-width: 350px; display: flex; flex-direction: column; align-items: center; }
        h1 { font-size: 2rem; color: var(--primary-color); margin-bottom: 20px; }
        .input-group { position: relative; width: 100%; margin-bottom: 15px; }
        .input-group input { width: 100%; padding: 12px 15px; padding-left: 45px; background-color: #f1f1f1; border: none; border-radius: 8px; outline: none; }
        .input-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }
        .btn-primary { background-color: var(--primary-color); color: var(--white); border: none; padding: 12px 45px; border-radius: 50px; cursor: pointer; font-weight: 600; margin-top: 10px; }
        
        /* Animation Logic */
        .container.active .form-box.sign-in { transform: translateX(100%); opacity: 0; z-index: 1; }
        .container.active .form-box.sign-up { transform: translateX(100%); opacity: 1; z-index: 5; animation: show 0.6s; }
        .container.active .banner-box { transform: translateX(-100%); }
        .container.active .banner-content.left { transform: translateX(0); }

        /* Alert Messages from Flash */
        .alert-box {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            display: flex; flex-direction: column; gap: 10px;
        }
        .alert { padding: 15px 20px; border-radius: 8px; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); animation: slideIn 0.5s ease; }
        .alert.success { background-color: #2ecc71; }
        .alert.error { background-color: #e74c3c; }
        .alert.info { background-color: #3498db; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

    <!-- Hiển thị thông báo từ Python -->
    <div class="alert-box">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert {{ category }}">
                  {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}
    </div>

    <div class="container" id="container">
        
        <!-- Form Đăng ký -->
        <div class="form-box sign-up">
            <!-- Quan trọng: action và method -->
            <form action="{{ url_for('register') }}" method="POST">
                <h1>Tạo tài khoản</h1>
                <span>đăng ký bằng email</span>
                
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <!-- Quan trọng: name="fullname" -->
                    <input type="text" name="fullname" placeholder="Họ và tên" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <!-- Quan trọng: name="email" -->
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <!-- Quan trọng: name="password" -->
                    <input type="password" name="password" placeholder="Mật khẩu" required>
                </div>
                
                <button type="submit" class="btn-primary">Đăng Ký</button>
            </form>
        </div>

        <!-- Form Đăng nhập -->
        <div class="form-box sign-in">
            <!-- Quan trọng: action và method -->
            <form action="{{ url_for('login') }}" method="POST">
                <h1>Đăng nhập</h1>
                <span>sử dụng tài khoản thư viện</span>
                
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" placeholder="Mật khẩu" required>
                </div>
                
                <div class="forgot-pass"><a href="#">Quên mật khẩu?</a></div>
                <button type="submit" class="btn-primary">Đăng Nhập</button>
            </form>
        </div>

        <!-- Banner chuyển đổi -->
        <div class="banner-box">
            <div class="banner-content">
                <h2>Chào mừng trở lại!</h2>
                <p>Kết nối với thư viện để quản lý sách mượn.</p>
                <button class="btn-outline" id="signUpBtn">Đăng Ký</button>
            </div>
        </div>
    </div>

    <script>
        // Script điều khiển hiệu ứng trượt
        const container = document.getElementById('container');
        const signUpBtn = document.getElementById('signUpBtn');
        const bannerBox = document.querySelector('.banner-box');
        
        const contentSignIn = `
            <h2>Chào mừng đến với thư viện!</h2>
            <p>Kết nối với thư viện để quản lý sách mượn.</p>
            <button class="btn-outline" id="signUpBtn">Đăng Ký</button>
        `;
        const contentSignUp = `
            <h2>Xin chào bạn mới!</h2>
            <p>Nhập thông tin cá nhân để bắt đầu.</p>
            <button class="btn-outline" id="signInBtn">Đăng Nhập</button>
        `;

        function attachToggleEvent() {
            const signInBtn = document.getElementById('signInBtn');
            const signUpBtnReal = document.getElementById('signUpBtn');

            if(signInBtn) {
                signInBtn.addEventListener('click', () => {
                    container.classList.remove('active');
                    setTimeout(() => {
                        bannerBox.innerHTML = '<div class="banner-content">' + contentSignIn + '</div>';
                        attachToggleEvent();
                    }, 300); 
                });
            }

            if(signUpBtnReal) {
                signUpBtnReal.addEventListener('click', () => {
                    container.classList.add('active');
                    setTimeout(() => {
                        bannerBox.innerHTML = '<div class="banner-content">' + contentSignUp + '</div>';
                        attachToggleEvent();
                    }, 300);
                });
            }
        }
        attachToggleEvent();
        
        // Tự động ẩn thông báo sau 3 giây
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => alert.style.display = 'none');
        }, 3000);
    </script>
</body>
</html>